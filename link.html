<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Linking Caliper programs &mdash; Caliper 1.6.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Caliper 1.6.0 documentation" href="index.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Source-code Annotations" href="AnnotationAPI.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="AnnotationAPI.html" title="Source-code Annotations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Caliper 1.6.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="linking-caliper-programs">
<h1>Linking Caliper programs<a class="headerlink" href="#linking-caliper-programs" title="Permalink to this headline">¶</a></h1>
<p>Typically, all that is needed to create a Caliper-enabled program is
to link it with the Caliper runtime library, which resides in
<code class="docutils literal"><span class="pre">libcaliper.so</span></code>. An example link command for a C++ program built
with g++ could look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>CALIPER_DIR  = /path/to/caliper/installation

g++ -o target-program $(OBJECTS) -L$(CALIPER_DIR)/lib -lcaliper
</pre></div>
</div>
<p>Note that Caliper is a C++ library: to link a C or Fortran program
with Caliper, either use a C++ linker, or manually add the C++
standard library to the link line (e.g., with <code class="docutils literal"><span class="pre">-lstdc++</span></code>).</p>
<div class="section" id="mpi">
<h2>MPI<a class="headerlink" href="#mpi" title="Permalink to this headline">¶</a></h2>
<p>Caliper provides wrappers for MPI calls in the separate
<code class="docutils literal"><span class="pre">libcaliper-mpiwrap.so</span></code> library. It is not strictly necessary to use
the wrapper library for MPI programs with Caliper
annotations. However, it will make Caliper&#8217;s behavior more
multi-process friendly, e.g. by reducing log output on most ranks. The
wrapper library <em>is</em> required to use Caliper&#8217;s MPI service.</p>
<p>To use the wrapper library, add it before the Caliper libraries in a
link command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>mpicxx -o target-program $(OBJECTS) -L$(CALIPER_DIR)/lib -lcaliper-mpiwrap -lcaliper
</pre></div>
</div>
</div>
<div class="section" id="fortran">
<h2>Fortran<a class="headerlink" href="#fortran" title="Permalink to this headline">¶</a></h2>
<p>Caliper provides a Fortran wrapper module in source code form under
<code class="docutils literal"><span class="pre">share/fortran/caliper.f90</span></code> in the Caliper installation
directory. This way, we avoid potential incompatibilities between
compilers used to build Caliper and the target program.
We recommend to simply add the Caliper module to the target
program. An example Makefile may look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>F90         = gfortran

CALIPER_DIR = /path/to/caliper/installation
OBJECTS     = main.o

target-program : $(OBJECTS) caliper.o
    $(F90) -o target-program $(OBJECTS) -L$(CALIPER_DIR)/lib -lcaliper -lstdc++

%.o : %.f90 caliper.mod
    $(F90) -c $&lt;

caliper.mod : caliper.o

caliper.o : $(CALIPER_DIR)/share/fortran/caliper.f90
    $(F90) -std=f2003 -c $&lt;
</pre></div>
</div>
<p>Note that it is necessary to link in the C++ standard library as
well. With <code class="docutils literal"><span class="pre">gfortran</span></code>, add <code class="docutils literal"><span class="pre">-lstdc++</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>gfortran -o target-program *.o -L/path/to/caliper/lib -lcaliper -lstdc++
</pre></div>
</div>
<p>With Intel <code class="docutils literal"><span class="pre">ifort</span></code>, you can use the <code class="docutils literal"><span class="pre">-cxxlib</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ifort -o target-program *.o -cxxlib -L/path/to/caliper/lib -lcaliper
</pre></div>
</div>
<p>The wrapper module uses Fortran 2003 C bindings. Thus, it requires a
Fortran 2003 compatible compiler to build, but should be usable with
any reasonably &#8220;modern&#8221; Fortran code. More work may be required to
integrate it with Fortran 77 codes.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/caliper-logo-small.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Linking Caliper programs</a><ul>
<li><a class="reference internal" href="#mpi">MPI</a></li>
<li><a class="reference internal" href="#fortran">Fortran</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="AnnotationAPI.html"
                        title="previous chapter">Source-code Annotations</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="next chapter">Configuration</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/link.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             >next</a> |</li>
        <li class="right" >
          <a href="AnnotationAPI.html" title="Source-code Annotations"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Caliper 1.6.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015-2016, Lawrence Livermore National Laboratory.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>