<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Caliper: A Performance Analysis Toolbox in a Library &mdash; Caliper 1.7.0-dev documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.7.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Caliper 1.7.0-dev documentation" href="#" />
    <link rel="next" title="Build and Link" href="build.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="build.html" title="Build and Link"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Caliper 1.7.0-dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="caliper-a-performance-analysis-toolbox-in-a-library">
<h1>Caliper: A Performance Analysis Toolbox in a Library<a class="headerlink" href="#caliper-a-performance-analysis-toolbox-in-a-library" title="Permalink to this headline">¶</a></h1>
<p>Caliper is a program instrumentation and performance measurement
framework. It is designed as a performance analysis toolbox in a
library, allowing one to bake performance analysis capabilities
directly into applications and activate them at runtime.
Caliper is primarily aimed at HPC applications, but works for
any C/C++/Fortran program on Unix/Linux.</p>
<p>Caliper&#8217;s data collection mechanisms and source-code annotation API
support a variety of performance engineering use cases, e.g.,
performance profiling, tracing, monitoring, and auto-tuning.</p>
<p>Features include:</p>
<ul class="simple">
<li>Low-overhead source-code annotation API</li>
<li>Flexible key:value data model: capture application-specific
features for performance analysis</li>
<li>Fully threadsafe implementation, support for parallel programming
models like MPI</li>
<li>Synchronous (event-based) and asynchronous (sampling) performance
data collection</li>
<li>Trace and profile recording with flexible on-line and off-line
data aggregation</li>
<li>Connection to third-party tools, e.g. NVidia NVProf or
Intel(R) VTune(tm)</li>
<li>Measurement and profiling functionality such as timers, PAPI
hardware counters, and Linux perf_events</li>
<li>Memory allocation annotations: associate performance measurements
with named memory regions</li>
</ul>
<p>Caliper is available for download on
<a class="reference external" href="https://github.com/LLNL/Caliper">GitHub</a>.</p>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build and Link</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Architecture and Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="AnnotationAPI.html">Source-code Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Runtime Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">Caliper Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="OutputFormats.html">Output formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Caliper Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="calql.html">The Caliper Query Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="DeveloperGuide.html">Developer Guide</a></li>
</ul>
</div>
</div>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Unlike traditional performance analysis tools, Caliper is designed to
be integrated directly within applications. This makes performance
analysis functionality accessible at any time and configurable at
runtime.</p>
<p>Typically, we integrate Caliper into a program by marking source-code
sections of interest with descriptive annotations. Performance
measurements, trace or profile collection, and reporting functionality
can then be enabled with runtime configuration options. Alternatively,
third-party tools can connect to Caliper and access information
provided by the source-code annotations.</p>
<div class="section" id="building-and-installing">
<h3>Building and installing<a class="headerlink" href="#building-and-installing" title="Permalink to this headline">¶</a></h3>
<p>Download Caliper from <a class="reference external" href="https://github.com/LLNL/Caliper">GitHub</a>.</p>
<p>Building and installing Caliper requires cmake 3.1+ and a current
C++11-compatible Compiler. Clone Caliper from github and proceed
as follows:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ git clone https://github.com/LLNL/Caliper.git
$ <span class="nb">cd</span> Caliper
$ mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
$ cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span>&lt;path to install location&gt; <span class="se">\</span>
    -DCMAKE_C_COMPILER<span class="o">=</span>&lt;path to c-compiler&gt; <span class="se">\</span>
    -DCMAKE_CXX_COMPILER<span class="o">=</span>&lt;path to c++-compiler&gt; <span class="se">\</span>
    ..
$ make
$ make install
</pre></div>
</div>
<p>See <a class="reference internal" href="build.html"><em>Build and Link</em></a> for more details.</p>
</div>
<div class="section" id="source-code-annotations">
<h3>Source-code annotations<a class="headerlink" href="#source-code-annotations" title="Permalink to this headline">¶</a></h3>
<p>Caliper&#8217;s source-code annotation API fulfills two purposes: First, it
lets us associate performance measurements with user-defined,
high-level context information. Second, we can trigger user-defined
actions at the instrumentation points, e.g. to measure the time spent
in individual regions. Measurement actions can be defined at runtime
and are disabled by default; generally, the source-code annotations
are lightweight enough to be left in production code.</p>
<p>The annotation APIs are available for C, C++, and Fortran. There are
high-level annotation macros for common scenarios such as marking
functions, loops, or sections of source-code. In addition, users can
export arbitrary key:value pairs to express application-specific
concepts.</p>
<p>The following example marks &#8220;initialization&#8221; and &#8220;main loop&#8221; phases in
a C++ code, and exports the main loop&#8217;s current iteration counter
using the high-level annotation macros:</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;caliper/cali.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="c1">// Mark this function</span>
    <span class="n">CALI_CXX_MARK_FUNCTION</span><span class="p">;</span>

    <span class="c1">// Mark the &quot;intialization&quot; phase</span>
    <span class="n">CALI_MARK_BEGIN</span><span class="p">(</span><span class="s">&quot;initialization&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">delta_t</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">;</span>
    <span class="n">CALI_MARK_END</span><span class="p">(</span><span class="s">&quot;initialization&quot;</span><span class="p">);</span>

    <span class="c1">// Mark the loop</span>
    <span class="n">CALI_CXX_MARK_LOOP_BEGIN</span><span class="p">(</span><span class="n">mainloop</span><span class="p">,</span> <span class="s">&quot;main loop&quot;</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Mark each loop iteration</span>
        <span class="n">CALI_CXX_MARK_LOOP_ITERATION</span><span class="p">(</span><span class="n">mainloop</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>

        <span class="c1">// A Caliper snapshot taken at this point will contain</span>
        <span class="c1">// { &quot;function&quot;=&quot;main&quot;, &quot;loop&quot;=&quot;main loop&quot;, &quot;iteration#main loop&quot;=&lt;i&gt; }</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="n">CALI_CXX_MARK_LOOP_END</span><span class="p">(</span><span class="n">mainloop</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="AnnotationAPI.html"><em>Source-code Annotations</em></a> chapter for a complete reference of the C,
C++, and Fortran annotation APIs.</p>
</div>
<div class="section" id="linking-the-caliper-library">
<h3>Linking the Caliper library<a class="headerlink" href="#linking-the-caliper-library" title="Permalink to this headline">¶</a></h3>
<p>To use Caliper, add annotation statements to your program and link it
against the Caliper library. Programs must be linked with the Caliper
runtime (libcaliper.so), as shown in the example link command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>g++ -o app app.o -L&lt;path to caliper installation&gt;/lib64 -lcaliper
</pre></div>
</div>
</div>
<div class="section" id="runtime-configuration">
<h3>Runtime configuration<a class="headerlink" href="#runtime-configuration" title="Permalink to this headline">¶</a></h3>
<p>Caliper&#8217;s performance measurement and data collection functionality
must be enabled and configured at runtime through Caliper&#8217;s
configuration API, configuration files, or environment variables. By
default, Caliper will keep track of the current Caliper context
provided by the annotation API calls (allowing third-party tools to
access program context information), but won&#8217;t run any performance
measurement or data recording on its own.</p>
<p>Generally, collecting performance data with Caliper requires selecting
a combination of Caliper <em>services</em> that implement specific
functionality and configuring them for the task at hand. However, for
some common scenarios, Caliper provides a set of pre-defined
configuration profiles. These profiles can be activated with the
<code class="docutils literal"><span class="pre">CALI_CONFIG_PROFILE</span></code> environment variable. For example, the
<code class="docutils literal"><span class="pre">runtime-report</span></code> configuration profile prints the total time (in
microseconds) spent in each code path based on the nesting of
annotated code regions:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ CALI_CONFIG_PROFILE=runtime-report ./examples/apps/cali-basic-annotations
Path          sum#time.duration
main                  20.000000
  main loop            8.000000
  init                10.000000
</pre></div>
</div>
<p>The example shows Caliper output for the <code class="docutils literal"><span class="pre">runtime-report</span></code>
configuration profile for the source-code annotation example above.</p>
<p>As another example, the <code class="docutils literal"><span class="pre">serial-trace</span></code> configuration profile
configures Caliper to record an event trace of each annotation event:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ CALI_CONFIG_PROFILE=serial-trace ./examples/apps/cali-basic-annotations
== CALIPER: Registered event trigger service
== CALIPER: Registered recorder service
== CALIPER: Registered timestamp service
== CALIPER: Registered trace service
== CALIPER: Initialized
== CALIPER: Flushing Caliper data
== CALIPER: Trace: Flushed 14 snapshots.
== CALIPER: Recorder: Wrote 71 records.
</pre></div>
</div>
<p>The trace data is stored in a <code class="docutils literal"><span class="pre">.cali</span></code> file in a text-based
Caliper-specific file format. Use the <code class="docutils literal"><span class="pre">cali-query</span></code> tool to filter,
aggregate, or print the recorded data. Here, we use <code class="docutils literal"><span class="pre">cali-query</span></code> to
print the recorded trace data in a human-readable json format:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>$ ls *.cali
171120-181836_40337_7LOlCN5RchWV.cali
$ cali-query 171120-181836_40337_7LOlCN5RchWV.cali -q <span class="s2">&quot;SELECT * FORMAT json(pretty)&quot;</span>
<span class="o">[</span>
<span class="o">{</span>
        <span class="s2">&quot;event.begin#function&quot;</span>:<span class="s2">&quot;main&quot;</span>
<span class="o">}</span>,
<span class="o">{</span>
        <span class="s2">&quot;event.begin#annotation&quot;</span>:<span class="s2">&quot;init&quot;</span>,
        <span class="s2">&quot;function&quot;</span>:<span class="s2">&quot;main&quot;</span>
<span class="o">}</span>,
<span class="o">{</span>
        <span class="s2">&quot;event.end#annotation&quot;</span>:<span class="s2">&quot;init&quot;</span>,
        <span class="s2">&quot;annotation&quot;</span>:<span class="s2">&quot;init&quot;</span>,
        <span class="s2">&quot;function&quot;</span>:<span class="s2">&quot;main&quot;</span>,
        <span class="s2">&quot;time.inclusive.duration&quot;</span>:14
<span class="o">}</span>,
<span class="o">{</span>
        <span class="s2">&quot;event.begin#loop&quot;</span>:<span class="s2">&quot;main loop&quot;</span>,
        <span class="s2">&quot;function&quot;</span>:<span class="s2">&quot;main&quot;</span>
<span class="o">}</span>,
<span class="o">{</span>
        <span class="s2">&quot;loop&quot;</span>:<span class="s2">&quot;main loop&quot;</span>,
        <span class="s2">&quot;function&quot;</span>:<span class="s2">&quot;main&quot;</span>,
        <span class="s2">&quot;event.begin#iteration#main loop&quot;</span>:0
<span class="o">}</span>,
...
</pre></div>
</div>
<p>The <a class="reference internal" href="configuration.html"><em>Runtime Configuration</em></a> section demonstrates the set up of Caliper runtime
configurations through environment variables or configuration files.</p>
</div>
<div class="section" id="where-to-go-from-here">
<h3>Where to go from here<a class="headerlink" href="#where-to-go-from-here" title="Permalink to this headline">¶</a></h3>
<p>Caliper&#8217;s performance measurement and data collection functionality is
provided by independent building blocks called <em>services</em>, each
implementing specific functionality (e.g., tracing, I/O, timing,
report formatting, sampling, etc.). The services can be enabled at
runtime in any combination. This makes Caliper highly flexible, but
the runtime configuration can be complex. The <a class="reference internal" href="workflow.html"><em>Architecture and Workflow</em></a> section
explains more about Caliper&#8217;s internal dataflow and how services
interact.</p>
</div>
</div>
<div class="section" id="index">
<h2>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span>Index</span></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#">
              <img class="logo" src="_static/caliper-logo-small.png" alt="Logo"/>
            </a></p>
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Caliper: A Performance Analysis Toolbox in a Library</a><ul>
<li><a class="reference internal" href="#contents">Contents</a></li>
<li><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li><a class="reference internal" href="#building-and-installing">Building and installing</a></li>
<li><a class="reference internal" href="#source-code-annotations">Source-code annotations</a></li>
<li><a class="reference internal" href="#linking-the-caliper-library">Linking the Caliper library</a></li>
<li><a class="reference internal" href="#runtime-configuration">Runtime configuration</a></li>
<li><a class="reference internal" href="#where-to-go-from-here">Where to go from here</a></li>
</ul>
</li>
<li><a class="reference internal" href="#index">Index</a></li>
</ul>
</li>
</ul>

  <h4>Next topic</h4>
  <p class="topless"><a href="build.html"
                        title="next chapter">Build and Link</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="build.html" title="Build and Link"
             >next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Caliper 1.7.0-dev documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015-2016, Lawrence Livermore National Laboratory.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>