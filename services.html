<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Caliper services &mdash; Caliper 1.5.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Caliper 1.5.0 documentation" href="index.html" />
    <link rel="next" title="Caliper Tools" href="tools.html" />
    <link rel="prev" title="Configuration" href="configuration.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tools.html" title="Caliper Tools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Caliper 1.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="caliper-services">
<h1>Caliper services<a class="headerlink" href="#caliper-services" title="Permalink to this headline">¶</a></h1>
<p>Caliper comes with a number of optional modules (<em>services</em>) that
provide measurement data or processing and data recording
capabilities. The flexible combination and configuration of these
services allows you to quickly assemble recording solutions for a wide
range of usage scenarios.</p>
<p>You can enable the services required for your measurement with the
<code class="docutils literal"><span class="pre">CALI_SERVICES_ENABLE</span></code> configuration variable, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">export</span> <span class="n">CALI_SERVICES_ENABLE</span><span class="o">=</span><span class="n">event</span><span class="p">:</span><span class="n">recorder</span><span class="p">:</span><span class="n">trace</span>
</pre></div>
</div>
<p>to create event-triggered context traces for an application.</p>
<p>The following sections describe the available service modules and
their configuration.</p>
<div class="section" id="aggregate">
<h2>Aggregate<a class="headerlink" href="#aggregate" title="Permalink to this headline">¶</a></h2>
<p>The <cite>aggregate</cite> service accumulates aggregation attributes (e.g., time
durations) of snapshots with a similar <cite>key</cite>, creating a profile.</p>
<dl class="envvar">
<dt id="envvar-CALI_AGGREGATE_KEY">
<code class="descname">CALI_AGGREGATE_KEY</code><a class="headerlink" href="#envvar-CALI_AGGREGATE_KEY" title="Permalink to this definition">¶</a></dt>
<dd><p>Colon-separated list of attributes that form the aggregation key
(see below).</p>
<p>Default: Empty (all attributes without the <code class="docutils literal"><span class="pre">ASVALUE</span></code> storage
property are key attributes).</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_AGGREGATE_ATTRIBUTES">
<code class="descname">CALI_AGGREGATE_ATTRIBUTES</code><a class="headerlink" href="#envvar-CALI_AGGREGATE_ATTRIBUTES" title="Permalink to this definition">¶</a></dt>
<dd><p>Colon-separated list of aggregation attributes. The aggregate
service aggregates values of aggregation attributes from all input
snapshots with similar aggregation keys. Note that only attributes
with the <code class="docutils literal"><span class="pre">ASVALUE</span></code> storage property can be aggregation
attributes.</p>
<p>Default: <code class="docutils literal"><span class="pre">time.inclusive.duration</span></code> (Generates event-triggered
time profiles, if <cite>event</cite> and <cite>timestamp</cite> services are enabled)</p>
</dd></dl>

<div class="section" id="aggregation-key">
<h3>Aggregation key<a class="headerlink" href="#aggregation-key" title="Permalink to this headline">¶</a></h3>
<p>The aggregation key defines for which attributes separate (aggregate)
snapshot records will be kept. That is, the aggregate service will
generate an aggregate snapshot record for each unique combination of
key values found in the input snapshots.  The values of the
aggregation attributes in the input snapshots will be accumulated and
appended to the aggregate snapshot.  The aggregate snapshot records
also include an <cite>aggregate.count</cite> attribute that indicates how many
input snapshots with the given aggregation key were found. Attributes
that are neither aggregation attributes nor part of the aggregation
key will not appear in the aggregate snapshot records.</p>
<p>As an example, consider the following program:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#include &lt;caliper/Annotation.h&gt;</span>

<span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cali</span><span class="o">::</span><span class="n">Annotation</span><span class="o">::</span><span class="n">Guard</span>
      <span class="n">g</span><span class="p">(</span> <span class="n">cali</span><span class="o">::</span><span class="n">Annotation</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">).</span><span class="n">begin</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span> <span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="p">{</span> <span class="c1">// &quot;A&quot; loop</span>
    <span class="n">cali</span><span class="o">::</span><span class="n">Annotation</span><span class="o">::</span><span class="n">Guard</span>
      <span class="n">g</span><span class="p">(</span> <span class="n">cali</span><span class="o">::</span><span class="n">Annotation</span><span class="p">(</span><span class="s">&quot;loop.id&quot;</span><span class="p">).</span><span class="n">begin</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span> <span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cali</span><span class="o">::</span><span class="n">Annotation</span><span class="p">(</span><span class="s">&quot;iteration&quot;</span><span class="p">).</span><span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

        <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">foo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="p">{</span> <span class="c1">// &quot;B&quot; loop</span>
    <span class="n">cali</span><span class="o">::</span><span class="n">Annotation</span><span class="o">::</span><span class="n">Guard</span>
      <span class="n">g</span><span class="p">(</span> <span class="n">cali</span><span class="o">::</span><span class="n">Annotation</span><span class="p">(</span><span class="s">&quot;loop.id&quot;</span><span class="p">).</span><span class="n">begin</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">)</span> <span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cali</span><span class="o">::</span><span class="n">Annotation</span><span class="p">(</span><span class="s">&quot;iteration&quot;</span><span class="p">).</span><span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

        <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Assuming snapshots are generated from the <cite>function</cite> annotation and
the aggregation key contains the <cite>function</cite>, <cite>loop.id</cite>, and
<cite>iteration</cite> attributes, the <cite>aggregate</cite> service will generate the
following aggregate snapshots :</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">A</span>  <span class="n">iteration</span><span class="o">=</span><span class="mi">0</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">2</span>
<span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">A</span>  <span class="n">iteration</span><span class="o">=</span><span class="mi">1</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">2</span>
<span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">A</span>  <span class="n">iteration</span><span class="o">=</span><span class="mi">2</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">2</span>
<span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">B</span>  <span class="n">iteration</span><span class="o">=</span><span class="mi">0</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">1</span>
<span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">B</span>  <span class="n">iteration</span><span class="o">=</span><span class="mi">1</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">1</span>
<span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">B</span>  <span class="n">iteration</span><span class="o">=</span><span class="mi">2</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">1</span>
<span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">B</span>  <span class="n">iteration</span><span class="o">=</span><span class="mi">3</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>Removing the <cite>iteration</cite> attribute from the aggregation key will
collapse input snapshots with different iteration values into a
single aggregate snapshot:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">A</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">6</span>
<span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">B</span>  <span class="n">function</span><span class="o">=</span><span class="n">foo</span>  <span class="n">aggregate</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">4</span>
</pre></div>
</div>
</div>
<div class="section" id="aggregation-attributes">
<h3>Aggregation attributes<a class="headerlink" href="#aggregation-attributes" title="Permalink to this headline">¶</a></h3>
<p>The aggregate service accumulates values of aggregation attributes in
input snapshots with similar aggregation keys. Specifically, it
reports the minimum and maximum value, and computes the sum of the
aggregation attributes in the input snapshots. Aggregate snapshots
include <cite>aggregate.(min|max|sum)#attribute-name</cite> attributes with the
minimum, maximum, and sum values for each aggregation attribute,
respectively.</p>
<p>Note that only attributes with the <code class="docutils literal"><span class="pre">ASVALUE</span></code> property can be
aggregation attributes.</p>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The following configuration generates a time profile for the function
annotation separated by loop id. Note: when using
<cite>time.inclusive.duration</cite> as aggregation attribute, we strongly
recommend to include the <cite>event.end</cite> event attributes for all
annotations of interest in the aggregation key (e.g.,
<cite>event.end#function</cite> in the example), or use the default, empty key.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ CALI_SERVICES_ENABLE</span><span class="o">=</span>aggregate:event:recorder:timestamp <span class="se">\</span>
    <span class="nv">CALI_EVENT_TRIGGER</span><span class="o">=</span><span class="k">function</span> <span class="se">\</span>
    <span class="nv">CALI_AGGREGATE_KEY</span><span class="o">=</span>event.end#function:loop.id <span class="se">\</span>
      ./test/cali-basic-aggregate
<span class="o">==</span> CALIPER: Registered aggregation <span class="nv">service</span>
<span class="o">==</span> CALIPER: Registered event <span class="nv">service</span>
<span class="o">==</span> CALIPER: Registered recorder <span class="nv">service</span>
<span class="o">==</span> CALIPER: Registered timestamp <span class="nv">service</span>
<span class="o">==</span> CALIPER: <span class="nv">Initialized</span>
<span class="o">==</span> CALIPER: aggregate: flushed <span class="m">4</span> snapshots.
<span class="o">==</span> CALIPER: Wrote <span class="m">57</span> records.
</pre></div>
</div>
<p>The resulting file has the following contents:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">A</span>  <span class="n">event</span><span class="o">.</span><span class="n">end</span><span class="c">#function=foo  aggregate.count=6</span>
  <span class="n">aggregate</span><span class="o">.</span><span class="n">min</span><span class="c">#time.inclusive.duration=25</span>
  <span class="n">aggregate</span><span class="o">.</span><span class="n">max</span><span class="c">#time.inclusive.duration=26</span>
  <span class="n">aggregate</span><span class="o">.</span><span class="n">sum</span><span class="c">#time.inclusice.duration=151</span>
<span class="n">loop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">B</span>  <span class="n">event</span><span class="o">.</span><span class="n">end</span><span class="c">#function=foo  aggregate.count=4</span>
  <span class="n">aggregate</span><span class="o">.</span><span class="n">min</span><span class="c">#time.inclusive.duration=25</span>
  <span class="n">aggregate</span><span class="o">.</span><span class="n">max</span><span class="c">#time.inclusive.duration=26</span>
  <span class="n">aggregate</span><span class="o">.</span><span class="n">sum</span><span class="c">#time.inclusice.duration=102</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="callpath">
<h2>Callpath<a class="headerlink" href="#callpath" title="Permalink to this headline">¶</a></h2>
<p>The <cite>callpath</cite> service uses libunwind to add callpaths to Caliper
context snapshots. By default, the callpath service provides
call-stack addresses. Set <code class="docutils literal"><span class="pre">CALI_CALLPATH_USE_NAMES=true</span></code> to retrieve
function names on-line. Call-path addresses are provided in the
<code class="docutils literal"><span class="pre">callpath.address</span></code> attribute, call-path region names in
<code class="docutils literal"><span class="pre">callpath.regname</span></code>. Example:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_SERVICES_ENABLE</span><span class="o">=</span>callpath:event:recorder:trace
<span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_CALLPATH_USE_NAME</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_CALLPATH_USE_ADDRESS</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">$ </span>./test/cali-basic
<span class="nv">$ </span>cali-query -e --print-attributes<span class="o">=</span>callpath.address:callpath.regname
<span class="nv">$ </span>callpath.address<span class="o">=</span>401207/2aaaac052d5d/400fd9,callpath.regname<span class="o">=</span>main/__libc_start_main/_start
</pre></div>
</div>
<p>The example shows the <code class="docutils literal"><span class="pre">callpath.address</span></code> and <code class="docutils literal"><span class="pre">callpath.regname</span></code>
attributes in Caliper context records.</p>
<dl class="envvar">
<dt id="envvar-CALI_CALLPATH_USE_NAME=(true|false)">
<code class="descname">CALI_CALLPATH_USE_NAME=(true|false)</code><a class="headerlink" href="#envvar-CALI_CALLPATH_USE_NAME=(true|false)" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide region names for call paths. Incurs higher overhead. Note
that region names for C++ and Fortran functions are not demangled.</p>
<p>Default: false.</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_CALLPATH_USE_ADDRESS=(true|false)">
<code class="descname">CALI_CALLPATH_USE_ADDRESS=(true|false)</code><a class="headerlink" href="#envvar-CALI_CALLPATH_USE_ADDRESS=(true|false)" title="Permalink to this definition">¶</a></dt>
<dd><p>Record region addresses for call paths.</p>
<p>Default: true.</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_CALLPATH_SKIP_FRAMES=&lt;numberofframes&gt;">
<code class="descname">CALI_CALLPATH_SKIP_FRAMES=&lt;number of frames&gt;</code><a class="headerlink" href="#envvar-CALI_CALLPATH_SKIP_FRAMES=<numberofframes>" title="Permalink to this definition">¶</a></dt>
<dd><p>Skip a number of stack frames. This avoids recording stack frames
within the Caliper library.</p>
<p>Default: 10</p>
</dd></dl>

</div>
<div class="section" id="environment-information">
<h2>Environment Information<a class="headerlink" href="#environment-information" title="Permalink to this headline">¶</a></h2>
<p>The environment information (<cite>env</cite>) service collects runtime
environment information at process startup and adds it to the Caliper
context.</p>
<p>Specifically, it collects</p>
<blockquote>
<div><ul class="simple">
<li>The process&#8217; command line (program name and arguments)</li>
<li>Machine type and hostname, and operating system type, release, and
version</li>
<li>Date and time of program start in text form</li>
</ul>
</div></blockquote>
<p>Moreover, the environment information service can put any environment
variable defined at program start on the Caliper blackboard.</p>
<dl class="envvar">
<dt id="envvar-CALI_ENV_EXTRA=(variable1:variable2:...)">
<code class="descname">CALI_ENV_EXTRA=(variable1:variable2:...)</code><a class="headerlink" href="#envvar-CALI_ENV_EXTRA=(variable1:variable2:...)" title="Permalink to this definition">¶</a></dt>
<dd><p>List of extra environment variables to import.</p>
<p>Default: empty</p>
</dd></dl>

</div>
<div class="section" id="event">
<h2>Event<a class="headerlink" href="#event" title="Permalink to this headline">¶</a></h2>
<p>The event trigger service triggers snapshots when attributes are
updated. It is possible to select a list of snapshot-triggering
attributes, or have any attribute update trigger snapshots.
Updates of attributes with the <code class="docutils literal"><span class="pre">CALI_ATTR_SKIP_EVENTS</span></code> property will
never trigger snapshots.</p>
<p>Snapshots triggered by the event service include an attribute which
describes the event that triggered the snapshot, in the following
form:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">event</span><span class="o">.&lt;</span><span class="n">begin</span><span class="o">|</span><span class="nb">set</span><span class="o">|</span><span class="n">end</span><span class="o">&gt;</span><span class="c">#&lt;attribute name&gt;=&lt;value&gt;</span>
</pre></div>
</div>
<p>For example, a snapshot triggered by the call
<code class="docutils literal"><span class="pre">cali_set_int_byname(&quot;my.iteration&quot;,</span> <span class="pre">42);</span></code> includes the attribute
<cite>event.set#my.iteration=42</cite> to describe the triggering event.</p>
<p>The following example shows the snapshots generated by the example
program in <a class="reference internal" href="usage.html"><span class="doc">Getting started</span></a>:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_SERVICES_ENABLE</span><span class="o">=</span>event:recorder:trace
<span class="nv">$ </span>./test/cali-basic
<span class="nv">$ </span>cali-query -e 150819-113409_40027_W5Z0mWvoJUyn.cali
event.begin#initialization<span class="o">=</span><span class="nb">true</span>,cali.snapshot.event.begin<span class="o">=</span>39
event.end#initialization<span class="o">=</span><span class="nb">true</span>,cali.snapshot.event.end<span class="o">=</span>39,initialization<span class="o">=</span><span class="nb">true</span>
event.begin#loop<span class="o">=</span><span class="nb">true</span>,cali.snapshot.event.begin<span class="o">=</span>53
event.set#iteration<span class="o">=</span>0,cali.snapshot.event.set<span class="o">=</span>63,loop<span class="o">=</span><span class="nb">true</span>
event.set#iteration<span class="o">=</span>1,cali.snapshot.event.set<span class="o">=</span>63,iteration<span class="o">=</span>0,loop<span class="o">=</span><span class="nb">true</span>
event.set#iteration<span class="o">=</span>2,cali.snapshot.event.set<span class="o">=</span>63,iteration<span class="o">=</span>1,loop<span class="o">=</span><span class="nb">true</span>
event.set#iteration<span class="o">=</span>3,cali.snapshot.event.set<span class="o">=</span>63,iteration<span class="o">=</span>2,loop<span class="o">=</span><span class="nb">true</span>
event.end#iteration<span class="o">=</span>3,cali.snapshot.event.end<span class="o">=</span>63,iteration<span class="o">=</span>3,loop<span class="o">=</span><span class="nb">true</span>
event.end#loop<span class="o">=</span><span class="nb">true</span>,cali.snapshot.event.end<span class="o">=</span>53,loop<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>By setting <code class="docutils literal"><span class="pre">CALI_EVENT_TRIGGER</span></code>, we can configure the example to
only trigger snapshot for &#8220;iteration&#8221; attribute updates:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_SERVICES_ENABLE</span><span class="o">=</span>event:recorder:trace
<span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_EVENT_TRIGGER</span><span class="o">=</span>iteration
<span class="nv">$ </span>./test/cali-basic
<span class="nv">$ </span>cali-query -e 150819-113409_40027_W5Z0mWvoJUyn.cali
event.set#iteration<span class="o">=</span>0,cali.snapshot.event.set<span class="o">=</span>63,loop<span class="o">=</span><span class="nb">true</span>
event.set#iteration<span class="o">=</span>1,cali.snapshot.event.set<span class="o">=</span>63,iteration<span class="o">=</span>0,loop<span class="o">=</span><span class="nb">true</span>
event.set#iteration<span class="o">=</span>2,cali.snapshot.event.set<span class="o">=</span>63,iteration<span class="o">=</span>1,loop<span class="o">=</span><span class="nb">true</span>
event.set#iteration<span class="o">=</span>3,cali.snapshot.event.set<span class="o">=</span>63,iteration<span class="o">=</span>2,loop<span class="o">=</span><span class="nb">true</span>
event.end#iteration<span class="o">=</span>3,cali.snapshot.event.end<span class="o">=</span>63,iteration<span class="o">=</span>3,loop<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<dl class="envvar">
<dt id="envvar-CALI_EVENT_TRIGGER=(attribute1:attribute2:...)">
<code class="descname">CALI_EVENT_TRIGGER=(attribute1:attribute2:...)</code><a class="headerlink" href="#envvar-CALI_EVENT_TRIGGER=(attribute1:attribute2:...)" title="Permalink to this definition">¶</a></dt>
<dd><p>List of attributes that trigger measurement snapshots.
If empty, all user attributes trigger snapshots.</p>
<p>Default: empty</p>
</dd></dl>

</div>
<div class="section" id="debug">
<h2>Debug<a class="headerlink" href="#debug" title="Permalink to this headline">¶</a></h2>
<p>The debug service prints an event log on the selected Caliper log
stream. This is useful to debug source-code annotations. Note that you
need to set Caliper&#8217;s verbosity level to at least 2 to see the log
output.</p>
<p>Example:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_SERVICES_ENABLE</span><span class="o">=</span>debug
<span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_LOG_VERBOSITY</span><span class="o">=</span>2
<span class="nv">$ </span>./test/cali-basic
<span class="o">==</span> CALIPER: Available services: callpath papi debug event pthread recorder timestamp <span class="nv">mpi</span>
<span class="o">==</span> CALIPER: Registered debug <span class="nv">service</span>
<span class="o">==</span> CALIPER: Initialized
...
<span class="o">==</span> CALIPER: Event: create_attribute <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> phase<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_begin <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> phase<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_begin <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> phase<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_end <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> phase<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_begin <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> phase<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: create_attribute <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> iteration<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_set <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> iteration<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_set <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> iteration<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_set <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> iteration<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_set <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> iteration<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_end <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> iteration<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_end <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> phase<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: pre_end <span class="o">(</span><span class="nv">attr</span> <span class="o">=</span> phase<span class="o">)</span>
<span class="o">==</span> CALIPER: Event: <span class="nv">finish</span>
<span class="o">==</span> CALIPER: Finished
</pre></div>
</div>
</div>
<div class="section" id="mpi">
<h2>MPI<a class="headerlink" href="#mpi" title="Permalink to this headline">¶</a></h2>
<p>The MPI service records MPI operations and the MPI rank. Use it to
keep track of the program execution spent in MPI. You can select the
MPI functions to track by setting <code class="docutils literal"><span class="pre">CALI_MPI_WHITELIST</span></code> or
<code class="docutils literal"><span class="pre">CALI_MPI_BLACKLIST</span></code> filters. By default, all MPI functions are
instrument.</p>
<p>MPI function names are stored in the <code class="docutils literal"><span class="pre">mpi.function</span></code> attribute, and
the MPI rank in the <code class="docutils literal"><span class="pre">mpi.rank</span></code> attribute.</p>
<p>Note that you have to link the <cite>libcaliper-mpiwrap</cite> library with the
application in addition to the regular Caliper libraries to obtain MPI
information.</p>
<dl class="envvar">
<dt id="envvar-CALI_MPI_WHITELIST=(MPI_Fn_1:MPI_Fn_2:...)">
<code class="descname">CALI_MPI_WHITELIST=(MPI_Fn_1:MPI_Fn_2:...)</code><a class="headerlink" href="#envvar-CALI_MPI_WHITELIST=(MPI_Fn_1:MPI_Fn_2:...)" title="Permalink to this definition">¶</a></dt>
<dd><p>List of MPI functions to instrument. If set, only whitelisted
functions will be instrumented.</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_MPI_BLACKLIST=(MPI_Fn_1:MPI_Fn_2:...)">
<code class="descname">CALI_MPI_BLACKLIST=(MPI_Fn_1:MPI_Fn_2:...)</code><a class="headerlink" href="#envvar-CALI_MPI_BLACKLIST=(MPI_Fn_1:MPI_Fn_2:...)" title="Permalink to this definition">¶</a></dt>
<dd><p>List of MPI functions that fill be filtered. Note: if both
whitelist and blacklist are set, only whitelisted functions will
be instrumented, and the blacklist will be applied to the
whitelisted functions.</p>
</dd></dl>

</div>
<div class="section" id="recorder">
<h2>Recorder<a class="headerlink" href="#recorder" title="Permalink to this headline">¶</a></h2>
<p>The recorder service writes Caliper I/O records into a file.</p>
<p>You can also set the directory and filename that should be used;
by default, the recorder service will auto-generate a
file name.</p>
<dl class="envvar">
<dt id="envvar-CALI_RECORDER_FILENAME=(stdout|stderr|filename)">
<code class="descname">CALI_RECORDER_FILENAME=(stdout|stderr|filename)</code><a class="headerlink" href="#envvar-CALI_RECORDER_FILENAME=(stdout|stderr|filename)" title="Permalink to this definition">¶</a></dt>
<dd><p>File name for context trace. May be set to <code class="docutils literal"><span class="pre">stdout</span></code> or <code class="docutils literal"><span class="pre">stderr</span></code>
to print to the standard output or error streams, respectively.</p>
<p>Default: not set, auto-generates a unique file name.</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_RECORDER_DIRECTORY=(directoryname)">
<code class="descname">CALI_RECORDER_DIRECTORY=(directory name)</code><a class="headerlink" href="#envvar-CALI_RECORDER_DIRECTORY=(directoryname)" title="Permalink to this definition">¶</a></dt>
<dd><p>Directory to write context trace files to. The directory must exist,
Caliper does not create it. Default: not set, use current working
directory.</p>
</dd></dl>

</div>
<div class="section" id="textlog">
<h2>Textlog<a class="headerlink" href="#textlog" title="Permalink to this headline">¶</a></h2>
<p>The textlog service prints a text representation of snapshots to a configurable
output stream. This can be used to print out a log of the program&#8217;s
progress at runtime.</p>
<p>Currently, text log output can only be triggered by attribute update events.
Therefore, the <cite>event</cite> service must be active as well.
You can select which attribute updates trigger a text log output, define the
output format, and set the output stream (stdout, stderr, or a file name).</p>
<p>The following example prints a text log for the <cite>phase</cite> attribute of the
test application with Caliper&#8217;s auto-generated format string:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_SERVICES_ENABLE</span><span class="o">=</span>event:textlog:timestamp
<span class="nv">$ </span><span class="nb">export </span><span class="nv">CALI_TEXTLOG_TRIGGER</span><span class="o">=</span>phase
<span class="nv">$ </span>./test/cali-basic
<span class="o">==</span> CALIPER: Registered event trigger <span class="nv">service</span>
<span class="o">==</span> CALIPER: Registered timestamp <span class="nv">service</span>
<span class="o">==</span> CALIPER: Registered text log <span class="nv">service</span>
<span class="o">==</span> CALIPER: Initialized
<span class="nv">phase</span><span class="o">=</span>main/init                                                       21
<span class="nv">phase</span><span class="o">=</span>main/loop                                                       84
<span class="nv">phase</span><span class="o">=</span>main                                                            <span class="nv">219</span>
<span class="o">==</span> CALIPER: Finished
</pre></div>
</div>
<dl class="envvar">
<dt id="envvar-CALI_TEXTLOG_TRIGGER=attr1:attr2:...">
<code class="descname">CALI_TEXTLOG_TRIGGER=attr1:attr2:...</code><a class="headerlink" href="#envvar-CALI_TEXTLOG_TRIGGER=attr1:attr2:..." title="Permalink to this definition">¶</a></dt>
<dd><p>Select attributes which trigger a text log output. Note that the <cite>event</cite>
service must be active in order to trigger snapshots in the first place,
and the attributes selected here must be in the list of attributes that
trigger snapshots (defined by <cite>CALI_EVENT_TRIGGER</cite>).</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_TEXTLOG_FORMATSTRING=(formatstring)">
<code class="descname">CALI_TEXTLOG_FORMATSTRING=(formatstring)</code><a class="headerlink" href="#envvar-CALI_TEXTLOG_FORMATSTRING=(formatstring)" title="Permalink to this definition">¶</a></dt>
<dd><p>Define what to print. The formatstring can contain fields, denoted by
<code class="docutils literal"><span class="pre">%attribute_name%</span></code>, which prints the value of an attribute. Optionally,
a field can contain a width specification, denoted by <code class="docutils literal"><span class="pre">[width]</span></code>, to set
the minimum width of a field. Any other text is printed verbatim.
For example, <code class="docutils literal"><span class="pre">Phase:</span> <span class="pre">%[32]app.phase%</span> <span class="pre">%[6]time.phase.duration%</span></code> writes
log strings with two fields: the value of the <cite>app.phase</cite> attribute with
a minimum width of 40 characters, and the value of  <cite>time.phase.duration</cite>
attribute with a minimum width of 6 characters, respectively. A resulting
log entry might look like this:</p>
<div class="highlight-sh"><div class="highlight"><pre>Phase: main/loop                       7018
</pre></div>
</div>
<p>Default: empty; Caliper will automatically create a format string based on
the selected trigger attributes.</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_TEXTLOG_FILENAME=(stdout|stderr|filename)">
<code class="descname">CALI_TEXTLOG_FILENAME=(stdout|stderr|filename)</code><a class="headerlink" href="#envvar-CALI_TEXTLOG_FILENAME=(stdout|stderr|filename)" title="Permalink to this definition">¶</a></dt>
<dd><p>File name for the text log. May be set to <code class="docutils literal"><span class="pre">stdout</span></code> or <code class="docutils literal"><span class="pre">stderr</span></code>
to print to the standard output or error streams, respectively.</p>
<p>Default: stdout</p>
</dd></dl>

</div>
<div class="section" id="timestamp">
<h2>Timestamp<a class="headerlink" href="#timestamp" title="Permalink to this headline">¶</a></h2>
<p>The timestamp service adds a time offset, timestamp, or duration to
context records. Note that timestamps are <em>not</em> synchronized between
nodes in a distributed-memory program.</p>
<dl class="envvar">
<dt id="envvar-CALI_TIMER_SNAPSHOT_DURATION=(true|false)">
<code class="descname">CALI_TIMER_SNAPSHOT_DURATION=(true|false)</code><a class="headerlink" href="#envvar-CALI_TIMER_SNAPSHOT_DURATION=(true|false)" title="Permalink to this definition">¶</a></dt>
<dd><p>Measure duration (in microseconds) of the context epoch (i.e., the
time between two consecutive context snapshots). The value will be
saved in the snapshot record as attribute <code class="docutils literal"><span class="pre">time.duration</span></code>.</p>
<p>Default: false</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_TIMER_OFFSET=(true|false)">
<code class="descname">CALI_TIMER_OFFSET=(true|false)</code><a class="headerlink" href="#envvar-CALI_TIMER_OFFSET=(true|false)" title="Permalink to this definition">¶</a></dt>
<dd><p>Include the time offset (time since program start, in microseconds)
with each context snapshot. The value will be saved in the snapshot
record as attribute <code class="docutils literal"><span class="pre">time.offset</span></code>.</p>
<p>Default: false</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_TIMER_TIMESTAMP=(true|false)">
<code class="descname">CALI_TIMER_TIMESTAMP=(true|false)</code><a class="headerlink" href="#envvar-CALI_TIMER_TIMESTAMP=(true|false)" title="Permalink to this definition">¶</a></dt>
<dd><p>Include absolute timestamp (time since UNIX epoch, in seconds) with
each context snapshot. The value will be saved in the snapshot record
as attribute <code class="docutils literal"><span class="pre">time.timestamp</span></code>.</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_TIMER_INCLUSIVE_DURATION=(true|false)">
<code class="descname">CALI_TIMER_INCLUSIVE_DURATION=(true|false)</code><a class="headerlink" href="#envvar-CALI_TIMER_INCLUSIVE_DURATION=(true|false)" title="Permalink to this definition">¶</a></dt>
<dd><p>For snapshots triggered by <code class="docutils literal"><span class="pre">set</span></code> or <code class="docutils literal"><span class="pre">end</span></code> events, calculate the
duration of the corresponding <code class="docutils literal"><span class="pre">begin-end</span></code>, <code class="docutils literal"><span class="pre">set-set</span></code>, or
<code class="docutils literal"><span class="pre">set-end</span></code> phase. The value will be saved in the snapshot record
as attribute <code class="docutils literal"><span class="pre">time.inclusive.duration</span></code>.</p>
<p>The event service with event trigger information generation needs
to be enabled for this feature.</p>
<p>Default: true</p>
</dd></dl>

</div>
<div class="section" id="trace">
<h2>Trace<a class="headerlink" href="#trace" title="Permalink to this headline">¶</a></h2>
<p>The trace service creates an I/O record for each snapshot. With the
<code class="docutils literal"><span class="pre">recorder</span></code> sercice enabled, this will create a snapshot trace file.</p>
<p>The trace service maintains per-thread snapshot buffers. By default,
trace buffers will grow automatically. This behavior can be changed by
setting a <em>buffer policy</em>. There are three options:</p>
<dl class="docutils">
<dt>Grow</dt>
<dd>Grow the buffer when it is full. This is the default.</dd>
<dt>Stop</dt>
<dd>Stop recording when the buffer is full.</dd>
<dt>Flush</dt>
<dd>Flush the buffer when it is full and continue recording. Note that
buffer flushes can significantly perturb the program&#8217;s
performance.</dd>
</dl>
<dl class="envvar">
<dt id="envvar-CALI_TRACE_BUFFER_SIZE">
<code class="descname">CALI_TRACE_BUFFER_SIZE</code><a class="headerlink" href="#envvar-CALI_TRACE_BUFFER_SIZE" title="Permalink to this definition">¶</a></dt>
<dd><p>Size of the trace buffer, in Megabytes. With the <cite>grow</cite> buffer
policy, this is the size of a trace buffer <em>chunk</em>: When the buffer
is full, another chunk of this size is added. Default: 2 (MiB).</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-CALI_TRACE_BUFFER_POLICY">
<code class="descname">CALI_TRACE_BUFFER_POLICY</code><a class="headerlink" href="#envvar-CALI_TRACE_BUFFER_POLICY" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the trace buffer policy (see above). Either <cite>grow</cite>, <cite>stop</cite>, or
<cite>flush</cite>. Default: <cite>grow</cite>.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/caliper-logo-small.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Caliper services</a><ul>
<li><a class="reference internal" href="#aggregate">Aggregate</a><ul>
<li><a class="reference internal" href="#aggregation-key">Aggregation key</a></li>
<li><a class="reference internal" href="#aggregation-attributes">Aggregation attributes</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#callpath">Callpath</a></li>
<li><a class="reference internal" href="#environment-information">Environment Information</a></li>
<li><a class="reference internal" href="#event">Event</a></li>
<li><a class="reference internal" href="#debug">Debug</a></li>
<li><a class="reference internal" href="#mpi">MPI</a></li>
<li><a class="reference internal" href="#recorder">Recorder</a></li>
<li><a class="reference internal" href="#textlog">Textlog</a></li>
<li><a class="reference internal" href="#timestamp">Timestamp</a></li>
<li><a class="reference internal" href="#trace">Trace</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="previous chapter">Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tools.html"
                        title="next chapter">Caliper Tools</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/services.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tools.html" title="Caliper Tools"
             >next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Caliper 1.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015-2016, Lawrence Livermore National Laboratory.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.
    </div>
  </body>
</html>